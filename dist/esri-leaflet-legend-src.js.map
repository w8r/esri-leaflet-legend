{"version":3,"sources":["../src/Util.js","../src/Services/MapService.js","../src/Tasks/Legend.js","../src/Layers/DynamicMapLayer.js","../src/Controls/Legend.js"],"names":[],"mappings":"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","file":"esri-leaflet-legend-src.js","sourcesContent":["/**\r\n * @example\r\n * <code>\r\n * L.esri.Util.queue(\r\n *   [1, 2, 3], [], function(curr, item, cb){\r\n *     setTimeout(function(){\r\n *       cb(null, curr.concat([item + 10]));\r\n *     }, 200);\r\n *   }, function(err, result) {\r\n *     console.log(result); // [11, 12, 13]\r\n * });\r\n * </code>\r\n * @param  {Array.<*>} values\r\n * @param  {*}         initial\r\n * @param  {Function}  fn       process item fn(memo, item, callback)\r\n * @param  {Function}  done     queue complete\r\n * @param  {*=}        context\r\n */\r\nEsriLeaflet.Util.reduce = function(values, initial, fn, cb, context) {\r\n  var curr = initial;\r\n\r\n  function next(index) {\r\n    var sync = true;\r\n    for (var i = index; i < values.length; i++) {\r\n      var done = false;\r\n      fn(curr, values[i], function(err, val) {\r\n        if (err) {\r\n          return cb.call(context, err, curr);\r\n        }\r\n        done = true;\r\n        curr = val;\r\n        if (!sync) {\r\n          next(i + 1);\r\n        }\r\n      });\r\n      sync = done;\r\n      if (!sync) {\r\n        return;\r\n      }\r\n    }\r\n    cb.call(context, null, curr);\r\n  }\r\n\r\n  next(0);\r\n};\r\n","EsriLeaflet.MapService.include({\r\n\r\n  legend: function(callback, context) {\r\n    return new EsriLeaflet.Legend(this).run(callback, context);\r\n  }\r\n\r\n});\r\n","EsriLeaflet.Legend = EsriLeaflet.Task.extend({\r\n  path: 'legend',\r\n\r\n  params: {\r\n    f: 'json'\r\n  },\r\n\r\n  run: function(callback, context) {\r\n    if (this._service) {\r\n      return this._service.request(this.path, this.params, callback, context);\r\n    } else {\r\n      return this._request('request', this.path, this.params, callback, context);\r\n    }\r\n  }\r\n\r\n});\r\n\r\nEsriLeaflet.legend = function(params) {\r\n  return new EsriLeaflet.Legend(params);\r\n};\r\n","EsriLeaflet.DynamicMapLayer.include({\r\n\r\n  legend: function(callback, context) {\r\n    return this.service.legend(callback, context);\r\n  }\r\n\r\n});\r\n","EsriLeaflet.LegendControl = L.Control.extend({\r\n\r\n  options: {\r\n    listTemplate: '<ul>{layers}</ul>',\r\n    layerTemplate: '<li><strong>{layerName}</strong><ul>{legends}</ul></li>',\r\n    listRowTemplate: '<li><img width=\"{width}\" height=\"{height}\" src=\"data:{contentType};base64,{imageData}\"><span>{label}</span></li>',\r\n    emptyLabel: '<all values>',\r\n    container: null\r\n  },\r\n\r\n  initialize: function(layers, options) {\r\n    this._layers = L.Util.isArray(layers) ? layers : [layers];\r\n    L.Control.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  onAdd: function(map) {\r\n    var container = this.options.container ||\r\n        L.DomUtil.create('div', 'leaflet-legend-control leaflet-bar');\r\n    L.DomEvent\r\n      .disableScrollPropagation(container)\r\n      .disableClickPropagation(container);\r\n\r\n    if (this._layers.length) {\r\n      this._load();\r\n    }\r\n    return container;\r\n  },\r\n\r\n  _load: function() {\r\n    L.esri.Util.reduce(this._layers, {\r\n      layers: []\r\n    }, function(curr, layer, cb) {\r\n      layer.legend(function(err, legend) {\r\n        if (err) {\r\n          return cb(err, curr);\r\n        }\r\n        curr.layers = curr.layers.concat(legend.layers);\r\n        cb(null, curr);\r\n      });\r\n    }, this._onLoad, this);\r\n  },\r\n\r\n  _onLoad: function(error, legend) {\r\n    if (!error) {\r\n      var layersHtml = '';\r\n      for (var i = 0, len = legend.layers.length; i < len; i++) {\r\n        var layer = legend.layers[i];\r\n        var legendsHtml = '';\r\n        for (var j = 0, jj = layer.legend.length; j < jj; j++) {\r\n          var layerLegend = JSON.parse(JSON.stringify(layer.legend[j]));\r\n          this._validateLegendLabel(layerLegend);\r\n          legendsHtml += L.Util.template(this.options.listRowTemplate, layerLegend);\r\n        }\r\n        layersHtml += L.Util.template(this.options.layerTemplate, {\r\n          layerName: layer.layerName,\r\n          legends: legendsHtml\r\n        });\r\n      }\r\n      this._container.innerHTML = L.Util.template(this.options.listTemplate, {\r\n        layers: layersHtml\r\n      });\r\n    }\r\n  },\r\n\r\n  _validateLegendLabel: function(layerLegend) {\r\n    if (!layerLegend.label && this.options.emptyLabel) {\r\n      layerLegend.label = this.options.emptyLabel;\r\n    }\r\n    layerLegend.label = layerLegend.label.replace(/&/g, '&amp;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&#39;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;');\r\n  }\r\n\r\n});\r\n\r\nEsriLeaflet.legendControl = function(layers, options) {\r\n  return new L.esri.LegendControl(layers, options);\r\n};\r\n"]}